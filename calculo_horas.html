<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Calculo de Horas Trabalhadas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">

</head>

<body>
    <h1>Cálculo de Horas Trabalhadas</h1>

    <table>
        <tr>
            <td>
                <label for="inicio_jornada">Hora Início Jornada</label>
                <input type="time" name="inicio_jornada" id="inicio_jornada">
            </td>
            <td>    
                <label for="inicio_intervalo_principal">Hora Início Intervalo</label>
                <input type="time" name="inicio_intervalo" id="inicio_intervalo_principal">
            </td>
            <td>
                <label for="final_intervalo_principal">Hora Início Intervalo</label>
                <input type="time" name="final_intervalo" id="final_intervalo_principal">
            </td>
            <td>
                <label for="fim_jornada">Hora Início Jornada</label>
                <input type="time" name="fim_jornada" id="fim_jornada">
            </td>
            <td>
                <button id="calcular_jornada">Calcular</button>
            </td>
        </tr>
    </table>
    <button id="botao_adicionar_intervalo">Adicionar Intervalo</button>
    <table id="tabela_intervalos_adicionais">
        
    </table>

<div name="resultado" id="resultado"></div>
    <script>
        class JornadaDeTrabalho {
            constructor(    
                horaInicioJornada,
                horaFimJornada,
                horaInicioIntervaloPrincipal,
                horaFimIntervaloPrincipal,
                listaDeIntervalosAdicionais = []
            ) {
                this.horaInicioJornada = horaInicioJornada;
                this.horaFimJornada = horaFimJornada;
                this.horaInicioIntervaloPrincipal = horaInicioIntervaloPrincipal;
                this.horaFimIntervaloPrincipal = horaFimIntervaloPrincipal;
                this.listaDeIntervalosAdicionais = listaDeIntervalosAdicionais;
            }

            static _horaParaMinutos(horaStr) {
                const [h, m] = horaStr.split(':').map(Number);
                return h * 60 + m;
            }

            static _diferencaEmMinutos(horaInicio, horaFim) {
                return JornadaDeTrabalho._horaParaMinutos(horaFim) - JornadaDeTrabalho._horaParaMinutos(horaInicio);
            }

             _totalMinutosDeIntervalo() {
                let total = JornadaDeTrabalho._diferencaEmMinutos(
                    this.horaInicioIntervaloPrincipal,
                    this.horaFimIntervaloPrincipal
                );

                for (const intervalo of this.listaDeIntervalosAdicionais) {
                    total += JornadaDeTrabalho._diferencaEmMinutos(intervalo.inicio, intervalo.final);
                }

                return total;
            }

            calcularHorasTrabalhadas() {
                const minutosJornada = JornadaDeTrabalho._diferencaEmMinutos(
                    this.horaInicioJornada,
                    this.horaFimJornada
                );

                const minutosIntervalo = this._totalMinutosDeIntervalo();
                const minutosTrabalhados = minutosJornada - minutosIntervalo;

                return {
                    horas: Math.floor(minutosTrabalhados / 60),
                    minutos: minutosTrabalhados % 60
                };
            }
        }

        function adicionaIntervaloAdicional(){
            const tabelaIntervalosAdicionais = document.querySelector("#tabela_intervalos_adicionais")
            const colunaIntervalosAdicionais = document.createElement("tr")
            const inicioIntervaloAdicional = document.createElement('input')
            inicioIntervaloAdicional.type = "time"
            inicioIntervaloAdicional.setAttribute("data-inicio","inicio")
            const finalIntervaloAdicional = document.createElement("input")
            finalIntervaloAdicional.type = "time"
            finalIntervaloAdicional.setAttribute("data-final","final")
            colunaIntervalosAdicionais.appendChild(inicioIntervaloAdicional)
            colunaIntervalosAdicionais.appendChild(finalIntervaloAdicional)
            tabelaIntervalosAdicionais.appendChild(colunaIntervalosAdicionais)
        }

        const botaoAdicionarIntervalo = document.querySelector("#botao_adicionar_intervalo")
        botaoAdicionarIntervalo.addEventListener("click", () =>{
            adicionaIntervaloAdicional()
        })

        function obtemIntervalosAdicionais(){
            const tabelaIntervalosAdicionais = document.querySelector("#tabela_intervalos_adicionais")
            const inputs = tabelaIntervalosAdicionais.querySelectorAll("input")
            let listaDeIntervalosAdicionais = []
            for(let i = 0; i < inputs.length; i+= 2){
                listaDeIntervalosAdicionais.push({"inicio": inputs[i].value || "00:00", "final": inputs[i+1].value || "00:00"})
            }
            return listaDeIntervalosAdicionais
        }

        const jornada = new JornadaDeTrabalho()

        const botaoCalcular = document.querySelector("#calcular_jornada")
        botaoCalcular.addEventListener('click', () => {            
            jornada.horaInicioJornada = document.querySelector("#inicio_jornada").value
            jornada.horaFimJornada = document.querySelector("#fim_jornada").value
            jornada.horaInicioIntervaloPrincipal = document.querySelector("#inicio_intervalo_principal").value
            jornada.horaFimIntervaloPrincipal = document.querySelector("#final_intervalo_principal").value
            jornada.listaDeIntervalosAdicionais = obtemIntervalosAdicionais()
            const calculo = jornada.calcularHorasTrabalhadas()
            document.querySelector("#resultado").innerHTML = calculo.horas + ":" + calculo.minutos
        });

    </script>

</body>

</html>