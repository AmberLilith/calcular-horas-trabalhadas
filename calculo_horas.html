<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Calculo de Horas Trabalhadas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">

</head>

<body>

    <div class="container">
        <header class="mt-3">
            <h1>Cálculo de Horas Trabalhadas</h1>
        </header>
        <div class="row border pt-2 pb-2 rounded">
            <h3>Horários da Jornada</h3>
            <div class="col-12 col-md">
                <label for="inicio_jornada">Hora Início Jornada</label>
                <input type="time" name="inicio_jornada" id="inicio_jornada" class="form-control">
            </div>
            <div class="col-12 col-md">
                <label for="inicio_intervalo_principal">Hora Início Intervalo</label>
                <input type="time" name="inicio_intervalo" id="inicio_intervalo_principal" class="form-control">
            </div>
            <div class="col-12 col-md">
                <label for="final_intervalo_principal">Hora Fim Intervalo</label>
                <input type="time" name="final_intervalo" id="final_intervalo_principal" class="form-control">
            </div>
            <div class="col-12 col-md">
                <label for="fim_jornada">Hora Fim Jornada</label>
                <input type="time" name="fim_jornada" id="fim_jornada" class="form-control">
            </div>
        </div>

        </br>
        
        <h4 class="text-center">Intervalos Adicionais</h4>
        <div id="horarios_adicionais" class="border pt-2 pb-2 rounded">
            <div class="row text-center">
                <div class="col">
                </div>
                <div class="col">
                </div>
                <div class="col">
                </div>
                <div class="col">
                    <button id="botao_adicionar_intervalo" class="btn btn-primary">Adicionar Intervalo</button>
                </div>
            </div>
        </div>

        <div class="row pt-2 pb-2 text-center">
            <div class="col">
            </div>
            <div class="col-6">
                <div name="resultado" id="resultado"></div>
            </div>
            <div class="col">
                <button id="calcular_jornada" class="btn btn-primary">Calcular</button>
            </div>
        </div>
    </div>

    <script>
        class JornadaDeTrabalho {
            constructor(
                horaInicioJornada,
                horaFimJornada,
                horaInicioIntervaloPrincipal,
                horaFimIntervaloPrincipal,
                listaDeIntervalosAdicionais = []
            ) {
                this.horaInicioJornada = horaInicioJornada;
                this.horaFimJornada = horaFimJornada;
                this.horaInicioIntervaloPrincipal = horaInicioIntervaloPrincipal;
                this.horaFimIntervaloPrincipal = horaFimIntervaloPrincipal;
                this.listaDeIntervalosAdicionais = listaDeIntervalosAdicionais;
            }

            static _horaParaMinutos(horaStr) {
                const [h, m] = horaStr.split(':').map(Number);
                return h * 60 + m;
            }

            static _diferencaEmMinutos(horaInicio, horaFim) {
                return JornadaDeTrabalho._horaParaMinutos(horaFim) - JornadaDeTrabalho._horaParaMinutos(horaInicio);
            }

            _totalMinutosDeIntervalo() {
                let total = JornadaDeTrabalho._diferencaEmMinutos(
                    this.horaInicioIntervaloPrincipal,
                    this.horaFimIntervaloPrincipal
                );

                for (const intervalo of this.listaDeIntervalosAdicionais) {
                    total += JornadaDeTrabalho._diferencaEmMinutos(intervalo.inicio, intervalo.final);
                }

                return total;
            }

            calcularHorasTrabalhadas() {
                const minutosJornada = JornadaDeTrabalho._diferencaEmMinutos(
                    this.horaInicioJornada,
                    this.horaFimJornada
                );

                const minutosIntervalo = this._totalMinutosDeIntervalo();
                const minutosTrabalhados = minutosJornada - minutosIntervalo;

                return {
                    horas: Math.floor(minutosTrabalhados / 60),
                    minutos: minutosTrabalhados % 60
                };
            }
        }

        const jornada = new JornadaDeTrabalho()

        let qtddIntervalosAdicionais = 0

        function adicionaIntervaloAdicional() {
            qtddIntervalosAdicionais++
            const row = document.createElement("div")
            row.className = "row mb-1"
            const col1 = document.createElement("div")
            col1.className = "col-3"

            const col2 = document.createElement("div")
            col2.className = "col-3"
            const inicioIntervaloAdicional = document.createElement('input')
            inicioIntervaloAdicional.type = "time"
            inicioIntervaloAdicional.setAttribute("data-inicio", "inicio")
            const label1 = document.createElement("label")
            label1.textContent = "Hora início " + qtddIntervalosAdicionais
            col2.append(label1)
            col2.appendChild(inicioIntervaloAdicional)


            const col3 = document.createElement("div")
            col3.className = "col-3"
            const finalIntervaloAdicional = document.createElement("input")
            finalIntervaloAdicional.type = "time"
            finalIntervaloAdicional.setAttribute("data-final", "final")
            const label2 = document.createElement("label")
            label2.textContent = "Hora final " + qtddIntervalosAdicionais
            col3.append(label2)
            col3.append(finalIntervaloAdicional)

            const col4 = document.createElement("div")
            col4.className = "col-3"

            row.appendChild(col1)
            row.appendChild(col2)
            row.appendChild(col3)
            row.appendChild(col4)
            document.querySelector("#horarios_adicionais").appendChild(row)

        }

        const botaoAdicionarIntervalo = document.querySelector("#botao_adicionar_intervalo")
        botaoAdicionarIntervalo.addEventListener("click", () => {
            adicionaIntervaloAdicional()
        })

        function obtemIntervalosAdicionais() {
            const tabelaIntervalosAdicionais = document.querySelector("#horarios_adicionais")
            const inputs = tabelaIntervalosAdicionais.querySelectorAll("input")
            let listaDeIntervalosAdicionais = []
            for (let i = 0; i < inputs.length; i += 2) {
                listaDeIntervalosAdicionais.push({ "inicio": inputs[i].value || "00:00", "final": inputs[i + 1].value || "00:00" })
            }
            return listaDeIntervalosAdicionais
        }



        const botaoCalcular = document.querySelector("#calcular_jornada")
        botaoCalcular.addEventListener('click', () => {
            jornada.horaInicioJornada = document.querySelector("#inicio_jornada").value
            jornada.horaFimJornada = document.querySelector("#fim_jornada").value
            jornada.horaInicioIntervaloPrincipal = document.querySelector("#inicio_intervalo_principal").value
            jornada.horaFimIntervaloPrincipal = document.querySelector("#final_intervalo_principal").value
            jornada.listaDeIntervalosAdicionais = obtemIntervalosAdicionais()
            const calculo = jornada.calcularHorasTrabalhadas()
            document.querySelector("#resultado").innerHTML = calculo.horas + ":" + calculo.minutos
        });

    </script>

</body>

</html>